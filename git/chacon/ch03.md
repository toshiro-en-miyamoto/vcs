# Chapter 3: Git Branching

## Creating a local repo

```bash
ch03 $ git init -b main
Initialized empty Git repository in /path/to/ch03/.git/
```

You have the branch `main`, but the branch does not have any commits yet.

```bash
ch03 $ git status
On branch main

No commits yet

nothing to commit (create/copy files and use "git add" to track)

ch03 $ git log --oneline
fatal: your current branch 'main' does not have any commits yet

ch03 $ git branch --verbose
ch03 $ 
```

`git init` has created 10 directories and 18 files: user1

```bash
ch03 $ ls -alR
.:
total 12
drwxrwxr-x 3 user1 user1 4096 Sep 13 20:16 .
drwxrwxr-x 4 user1 user1 4096 Sep 13 20:14 ..
drwxrwxr-x 7 user1 user1 4096 Sep 13 20:17 .git

./.git:
total 40
drwxrwxr-x 7 user1 user1 4096 Sep 13 20:17 .
drwxrwxr-x 3 user1 user1 4096 Sep 13 20:16 ..
-rw-rw-r-- 1 user1 user1   21 Sep 13 20:16 HEAD
drwxrwxr-x 2 user1 user1 4096 Sep 13 20:16 branches
-rw-rw-r-- 1 user1 user1   92 Sep 13 20:16 config
-rw-rw-r-- 1 user1 user1   73 Sep 13 20:16 description
drwxrwxr-x 2 user1 user1 4096 Sep 13 20:16 hooks
drwxrwxr-x 2 user1 user1 4096 Sep 13 20:16 info
drwxrwxr-x 4 user1 user1 4096 Sep 13 20:16 objects
drwxrwxr-x 4 user1 user1 4096 Sep 13 20:16 refs

./.git/branches:
total 8
drwxrwxr-x 2 user1 user1 4096 Sep 13 20:16 .
drwxrwxr-x 7 user1 user1 4096 Sep 13 20:17 ..

./.git/hooks:
total 72
drwxrwxr-x 2 user1 user1 4096 Sep 13 20:16 .
drwxrwxr-x 7 user1 user1 4096 Sep 13 20:17 ..
-rwxrwxr-x 1 user1 user1  478 Sep 13 20:16 applypatch-msg.sample
-rwxrwxr-x 1 user1 user1  896 Sep 13 20:16 commit-msg.sample
-rwxrwxr-x 1 user1 user1 4726 Sep 13 20:16 fsmonitor-watchman.sample
-rwxrwxr-x 1 user1 user1  189 Sep 13 20:16 post-update.sample
-rwxrwxr-x 1 user1 user1  424 Sep 13 20:16 pre-applypatch.sample
-rwxrwxr-x 1 user1 user1 1643 Sep 13 20:16 pre-commit.sample
-rwxrwxr-x 1 user1 user1  416 Sep 13 20:16 pre-merge-commit.sample
-rwxrwxr-x 1 user1 user1 1374 Sep 13 20:16 pre-push.sample
-rwxrwxr-x 1 user1 user1 4898 Sep 13 20:16 pre-rebase.sample
-rwxrwxr-x 1 user1 user1  544 Sep 13 20:16 pre-receive.sample
-rwxrwxr-x 1 user1 user1 1492 Sep 13 20:16 prepare-commit-msg.sample
-rwxrwxr-x 1 user1 user1 2783 Sep 13 20:16 push-to-checkout.sample
-rwxrwxr-x 1 user1 user1 2308 Sep 13 20:16 sendemail-validate.sample
-rwxrwxr-x 1 user1 user1 3650 Sep 13 20:16 update.sample

./.git/info:
total 12
drwxrwxr-x 2 user1 user1 4096 Sep 13 20:16 .
drwxrwxr-x 7 user1 user1 4096 Sep 13 20:17 ..
-rw-rw-r-- 1 user1 user1  240 Sep 13 20:16 exclude

./.git/objects:
total 16
drwxrwxr-x 4 user1 user1 4096 Sep 13 20:16 .
drwxrwxr-x 7 user1 user1 4096 Sep 13 20:17 ..
drwxrwxr-x 2 user1 user1 4096 Sep 13 20:16 info
drwxrwxr-x 2 user1 user1 4096 Sep 13 20:16 pack

./.git/objects/info:
total 8
drwxrwxr-x 2 user1 user1 4096 Sep 13 20:16 .
drwxrwxr-x 4 user1 user1 4096 Sep 13 20:16 ..

./.git/objects/pack:
total 8
drwxrwxr-x 2 user1 user1 4096 Sep 13 20:16 .
drwxrwxr-x 4 user1 user1 4096 Sep 13 20:16 ..

./.git/refs:
total 16
drwxrwxr-x 4 user1 user1 4096 Sep 13 20:16 .
drwxrwxr-x 7 user1 user1 4096 Sep 13 20:17 ..
drwxrwxr-x 2 user1 user1 4096 Sep 13 20:16 heads
drwxrwxr-x 2 user1 user1 4096 Sep 13 20:16 tags

./.git/refs/heads:
total 8
drwxrwxr-x 2 user1 user1 4096 Sep 13 20:16 .
drwxrwxr-x 4 user1 user1 4096 Sep 13 20:16 ..

./.git/refs/tags:
total 8
drwxrwxr-x 2 user1 user1 4096 Sep 13 20:16 .
drwxrwxr-x 4 user1 user1 4096 Sep 13 20:16 ..

ch03 $ cat .git/HEAD
ref: refs/heads/main

ch03 $ cat .git/config
[core]
	repositoryformatversion = 0
	filemode = true
	bare = false
	logallrefupdates = true

ch03 $ cat .git/description
Unnamed repository; edit this file 'description' to name the repository.

h03 $ cat .git/info/exclude
# git ls-files --others --exclude-from=.git/info/exclude
# Lines that start with '#' are comments.
# For a project mostly in C, the following would be a good set of
# exclude patterns (uncomment them if you want to use them):
# *.[oa]
# *~

ch03 $ cat .git/hooks/post-update.sample
#!/bin/sh
#
# An example hook script to prepare a packed repository for use over
# dumb transports.
#
# To enable this hook, rename this file to "post-update".

exec git update-server-info

ch03 $
```

## Creating/editing files

```bash
$ cat README
== Testing library
This library is used to test Ruby projects.

ch03 $ cat LICENSE
The MIT License
Copyright (c) 2000 Scott Chacon

ch03 $ cat test.rb
require 'logger'
require 'test/unit'

class Test::Unit::TestCase

ch03 $
```

`git` knows files you've created, but they are not tracked yet.

```bash
ch03 $ git status
On branch main

No commits yet

Untracked files:
  (use "git add <file>..." to include in what will be committed)
	LICENSE
	README
	test.rb

nothing added to commit but untracked files present (use "git add" to track)
```

## Adding files

```bash
ch03 $ git status
On branch main

No commits yet

Changes to be committed:
  (use "git rm --cached <file>..." to unstage)
	new file:   LICENSE
	new file:   README
	new file:   test.rb
```

`git add` has created the `.git/index` file:

```bash
ch03 $ hexdump -C .git/index
00000000  44 49 52 43 00 00 00 02  00 00 00 03 66 e4 31 03  |DIRC........f.1.|
00000010  22 e2 2c a1 66 e4 31 03  22 a5 23 ca 00 00 b3 02  |".,.f.1.".#.....|
00000020  00 0a 65 22 00 00 81 a4  00 00 03 ea 00 00 03 ea  |..e"............|
00000030  00 00 00 30 70 45 d3 35  f6 81 33 33 40 d0 c0 89  |...0pE.5..33@...|
00000040  94 2a a3 8d d2 96 dd f6  00 07 4c 49 43 45 4e 53  |.*........LICENS|
00000050  45 00 00 00 66 e4 30 ef  1f db 4b 15 66 e4 30 ef  |E...f.0...K.f.0.|
00000060  1f 9e 42 43 00 00 b3 02  00 0a 65 15 00 00 81 a4  |..BC......e.....|
00000070  00 00 03 ea 00 00 03 ea  00 00 00 3f 3c ea 8d cb  |...........?<...|
00000080  6e 1e 95 6f 82 ea 54 f6  b5 b5 a3 87 26 9b d0 92  |n..o..T.....&...|
00000090  00 06 52 45 41 44 4d 45  00 00 00 00 66 e4 31 1f  |..README....f.1.|
000000a0  2d 2d d0 75 66 e4 31 1f  2c f0 c7 98 00 00 b3 02  |--.uf.1.,.......|
000000b0  00 09 f4 e8 00 00 81 a4  00 00 03 ea 00 00 03 ea  |................|
000000c0  00 00 00 41 10 b2 ec 8f  74 f8 b3 ba 7d d3 99 7f  |...A....t...}...|
000000d0  88 fb 50 83 b3 5c 7e 6d  00 07 74 65 73 74 2e 72  |..P..\~m..test.r|
000000e0  62 00 00 00 f5 55 85 99  d5 5e 6b a8 b1 49 fc 36  |b....U...^k..I.6|
000000f0  aa a9 09 4e da 05 e5 28                           |...N...(|
000000f8
```

And object files as well.

```bash
ch03 $ find .git/objects -type f
.git/objects/10/b2ec8f74f8b3ba7dd3997f88fb5083b35c7e6d
.git/objects/3c/ea8dcb6e1e956f82ea54f6b5b5a387269bd092
.git/objects/70/45d335f681333340d0c089942aa38dd296ddf6
```

They are named with the SHA-1 checksum of the content and its header. The subdirectory is named with the first 2 characters of the SHA-1, and the filename is the remaining 38 characters.

```bash
ch03 $ cat README | git hash-object --stdin
3cea8dcb6e1e956f82ea54f6b5b5a387269bd092

ch03 $ cat LICENSE | git hash-object --stdin
7045d335f681333340d0c089942aa38dd296ddf6

ch03 $ cat test.rb | git hash-object --stdin
10b2ec8f74f8b3ba7dd3997f88fb5083b35c7e6d
```

But they are not text files:

```bash
ch03 $ hexdump -C .git/objects/3c/ea8dcb6e1e956f82ea54f6b5b5a387269bd092
00000000  78 01 4b ca c9 4f 52 30  33 66 b0 b5 55 08 49 2d  |x.K..OR03f..U.I-|
00000010  2e c9 cc 4b 57 c8 c9 4c  2a 4a 2c aa e4 0a c9 c8  |...KW..L*J,.....|
00000020  2c 86 71 14 80 cc d2 e2  d4 14 85 92 7c 85 12 a0  |,.q.........|...|
00000030  3a 85 a0 d2 a4 4a 85 82  a2 fc ac d4 e4 92 62 3d  |:....J........b=|
00000040  2e 00 61 53 18 a1                                 |..aS..|
00000046

ch03 $ hexdump -C .git/objects/70/45d335f681333340d0c089942aa38dd296ddf6
00000000  78 01 4b ca c9 4f 52 30  b1 60 08 c9 48 55 f0 f5  |x.K..OR0.`..HU..|
00000010  0c 51 f0 c9 4c 4e cd 2b  4e e5 72 ce 2f a8 2c ca  |.Q..LN.+N.r./.,.|
00000020  4c cf 28 51 d0 48 d6 54  30 32 30 30 50 08 4e ce  |L.(Q.H.T0200P.N.|
00000030  2f 29 51 70 ce 48 4c ce  cf e3 02 00 ed 9a 11 56  |/)Qp.HL........V|
00000040

ch03 $ hexdump -C .git/objects/10/b2ec8f74f8b3ba7dd3997f88fb5083b35c7e6d
00000000  78 01 4b ca c9 4f 52 30  33 65 28 4a 2d 2c cd 2c  |x.K..OR03e(J-,.,|
00000010  4a 55 50 cf c9 4f 4f 4f  2d 52 e7 82 0b 94 a4 16  |JUP..OOO-R......|
00000020  97 e8 97 e6 65 96 a8 73  71 25 e7 24 16 17 2b 84  |....e..sq%.$..+.|
00000030  00 45 ac ac 42 81 42 56  56 20 b6 73 62 71 2a 17  |.E..B.BVV .sbq*.|
00000040  00 94 73 18 d2                                    |..s..|
00000045
```

Once you have content in your object database, you can examine that content with the `git cat-file` command.

```bash
ch03 $ git cat-file -p 3cea8dcb
== Testing library
This library is used to test Ruby projects.

ch03 $ git cat-file -p 7045d335
The MIT License
Copyright (c) 2000 Scott Chacon

ch03 $ git cat-file -p 10b2ec8f
require 'logger'
require 'test/unit'

class Test::Unit::TestCase
```
